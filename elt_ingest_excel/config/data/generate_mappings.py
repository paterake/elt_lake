import csv
import os

# Define the mapping based on the SQL files analysis
# Format: {sheet_name: [(output_column, source_column), ...]}

mappings = {
    'workday_customer_name': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Reference ID', 'nrm_customer_number'),
        ('Customer Category', 'customer_class'),
        ('Business Entity Name', None),
        ('External Entity ID', 'nrm_customer_number'),
        ('Preferred Locale', 'nrm_country_code'),
        ('Preferred Language', 'nrm_language_code'),
        ('Lockbox', None),
        ('Customer Security Segment', None),
        ('Worktag Only?', None),
        ('Submit?', 'inactive (transformed)'),
        ('Create Customer from Financial Institution', None),
        ('Create Customer from Supplier', None),
        ('Create Customer from Tax Authority', None),
        ('Create Customer from Investor', None),
    ],
    'workday_customer_address': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Formatted Address', None),
        ('Address Format Type', None),
        ('Defaulted Business Site Address', None),
        ('Delete', None),
        ('Do Not Replace All', None),
        ('Last Modified', None),
        ('Descriptor', None),
        ('Address ID', 'customer_id + address_code'),
        ('Country', 'nrm_country_name'),
        ('Country Code', 'nrm_country_code'),
        ('Region', 'county (via ref tables)'),
        ('Subregion', None),
        ('City', 'city (via ref tables)'),
        ('Submunicipality', None),
        ('Address Line #1', 'address_1'),
        ('Address Line #2', 'address_2'),
        ('Address Line #3', 'address_3'),
        ('Address Line #4', None),
        ('Postal Code', 'post_code'),
        ('Public', 'Yes (constant)'),
        ('Primary', 'Yes (constant)'),
        ('Type', None),
        ('Effective Date', None),
        ('Use For', None),
        ('Use For Tenanted', None),
        ('Comments', None),
        ('Number of Days', None),
        ('Municipality Local', None),
        ('Address', None),
    ],
    'workday_customer_bank_account_address': [
        ('Customer Name', 'nrm_customer_name'),
        ('Customer ID', 'customer_id'),
        ('Settlement Bank Account ID', 'customer_id + _BANK'),
        ('Intermediary Bank Account ID', None),
        ('Address ID', 'customer_id + _BANK_ADDR'),
        ('Country', 'nrm_country_name'),
        ('Region', 'county'),
        ('Subregion', None),
        ('City', 'city'),
        ('Submunicipality', None),
        ('Address Line #1', 'address_1'),
        ('Address Line #2', 'address_2'),
        ('Address Line #3', 'address_3'),
        ('Address Line #4', None),
        ('Postal Code', 'post_code'),
        ('Public', 'Yes (constant)'),
        ('Primary', 'Yes (constant)'),
        ('Effective Date', 'created_date'),
        ('Type', 'address_code'),
        ('Use For', 'address_code'),
        ('Use For Tenanted', None),
    ],
    'workday_customer_company_restrictions': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Restricted to Companies', 'pipe_target_business_unit'),
    ],
    'workday_customer_credit_card': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Merchant Customer Profile ID', None),
        ('Primary Card?', None),
        ('Merchant Account', None),
        ('Credit Card Type', None),
        ('First Name', None),
        ('Last Name', None),
        ('Expiration Date', None),
        ('Last 4 Digits of Credit Card Number', None),
        ('Customer Profile ID', None),
    ],
    'workday_customer_credit': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('DUNS Number', None),
        ('Exempt From Dunning', None),
        ('Tax Code', 'tax_schedule_id'),
        ('Credit Limit Currency', 'nrm_currency_code'),
        ('Credit Limit', 'credit_limit_amount'),
        ('Hierarchy Credit Limit', None),
        ('Credit Verification Date', 'created_date'),
        ('Commercial Credit Score', None),
        ('Commercial Credit Score Date', None),
        ('Commercial Credit Score Note', None),
        ('Composite Risk Score', None),
        ('Composite Risk Date', None),
        ('Composite Risk Note', None),
        ('Customer Satisfaction Score', None),
        ('Customer Satisfaction Date', None),
        ('Customer Satisfaction Note', None),
    ],
    'workday_customer_currencies': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Accepted Currencies', 'nrm_currency_code'),
        ('Default Currency', 'nrm_currency_code'),
    ],
    'workday_customer_document_delivery': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Always Separate Payments?', None),
        ('Remit-from Customer', None),
        ('Invoice Delivery Method', 'email_to_address (derived)'),
        ('Invoice Notification Email Recipients', 'email_to_address'),
        ('Statement Delivery Method', 'email_to_address (derived)'),
        ('Statement Notification Email Recipients', 'email_to_address'),
        ('Dunning Delivery Method', None),
        ('Dunning Letter Notification Email Recipients', None),
        ('Electronic Invoicing Start Date', None),
        ('Electronic Invoicing Government Issued Customer ID', None),
        ('Electronic Invoicing Intermediary Vendor ID', None),
        ('Electronic Invoicing Vendor Issued Customer ID', None),
        ('Mandate Required?', None),
        ('Direct Debit Payment Type', None),
        ('Default Mandate', None),
    ],
    'workday_customer_email': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Email ID', 'customer_id + suffix + rank'),
        ('Email Address', 'email_to_address / email_cc_address / email_bcc_address'),
        ('Email Comment', None),
        ('Public', 'Yes (constant)'),
        ('Primary', 'Derived from email_type and rank'),
        ('Type', 'email_type (to/cc/bcc)'),
        ('Use For', 'Business (constant)'),
        ('Use For Tenated', None),
        ('Delete', None),
        ('Do Not Replace All', None),
        ('Comments', None),
        ('Email', None),
    ],
    'workday_customer_groups': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Customer Group', 'key_customer_name (derived A-L/M-Z/0-9)'),
    ],
    'workday_customer_intermediary_account': [
        ('Settlement Bank Account ID', 'customer_id + _BANK'),
        ('Customer Name', 'nrm_customer_name'),
        ('Customer ID', 'customer_id'),
        ('Intermediary Bank Account ID', 'customer_id + _INTBANK'),
        ('Bank Country', 'nrm_country_name'),
        ('Currency', 'nrm_currency_code'),
        ('Bank Account Type', 'CHECKING (constant)'),
        ('Bank Name', None),
        ('Name on Account', None),
        ('Bank Account Number', None),
        ('Bank Account Nickname', 'short_name + Intermediary'),
        ('Routing Transit Number', None),
        ('IBAN', None),
        ('SWIFT Bank Identification Code', None),
        ('Roll Number', None),
        ('Check Digit', None),
        ('Branch ID', None),
        ('Branch Name', None),
        ('Inactive', 'inactive (transformed)'),
        ('Bank Instructions', None),
    ],
    'workday_customer_payment': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Payment Terms', 'payment_terms_id (via mapping)'),
        ('Default Payment Type', 'nrm_currency_code (derived)'),
        ('Interest Rule', None),
        ('Late Fee Rule', None),
    ],
    'workday_customer_phone': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Phone ID', 'customer_id + suffix + rank'),
        ('Phone Country', 'country'),
        ('Country Code', 'nrm_country_code'),
        ('International Phone Code', 'nrm_phone_code'),
        ('Area Code', 'Derived from phone number'),
        ('Phone Number', 'phone_1/phone_2/phone_3/fax (cleaned)'),
        ('Formatted Phone Number', 'Derived'),
        ('Phone Number Extension', None),
        ('Phone Device Type', 'Derived from phone type'),
        ('Public', 'Yes (constant)'),
        ('Primary', 'Derived from phone_type'),
        ('Type', 'phone_type (primary/secondary/tertiary/fax)'),
        ('Use For', None),
        ('Use For Tenated', None),
        ('Tenant Formatted Phone', None),
        ('International Formatted Phone', None),
        ('Delete', None),
        ('Do Not Replace All', None),
        ('Comments', None),
        ('Phone', None),
    ],
    'workday_customer_related_worktags': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Worktag Type', 'Customer (constant)'),
        ('Required On Transaction?', None),
        ('Required On Transaction For Validation?', None),
        ('Delete Default Value?', None),
        ('Worktag ID Type', None),
        ('Default Worktag ID Value', None),
        ('External Supplier Invoice Source', None),
        ('Replace All Allowed Values?', None),
        ('Delete Allowed Values?', None),
        ('Allowed Worktag ID Value', None),
    ],
    'workday_customer_settlement_account': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Settlement Bank Account ID', 'customer_id + _BANK'),
        ('Country', 'nrm_country_name'),
        ('Currency', 'nrm_currency_code'),
        ('Bank Account Nickname', 'statement_name or nrm_customer_name'),
        ('Bank Account Type', 'Checking (constant)'),
        ('Bank Name', None),
        ('Routing Transit Number', None),
        ('Branch ID', None),
        ('Branch Name', None),
        ('Bank Account Number', None),
        ('Check Digit', None),
        ('Name on Account', 'statement_name or nrm_customer_name'),
        ('Roll Number', None),
        ('IBAN', None),
        ('SWIFT Bank Identification Code', None),
        ('Accepts Payment Types', 'nrm_currency_code (derived)'),
        ('Payment Types', 'nrm_currency_code (derived)'),
        ('For Supplier Connections Only', None),
        ('Requires Prenote', None),
        ('Payment Type Prenote', None),
        ('Inactive', None),
        ('Bank Instructions', None),
    ],
    'workday_customer_tax': [
        ('Customer ID', 'customer_id'),
        ('Customer Name', 'nrm_customer_name'),
        ('Tax Code', 'tax_schedule_id'),
        ('Tax ID Country', 'nrm_country_name'),
        ('Tax ID', 'tax_registration_number'),
        ('Tax ID Type', 'nrm_tax_id_type'),
        ('Primary Tax ID?', None),
        ('Transaction Tax ID?', None),
        ('Tax Status Country', 'nrm_country_name'),
        ('Transaction Tax Status', None),
        ('Withholding Tax Status', None),
    ],
}

# Excel column equivalents
excel_equivalents = {
    'customer_id': 'Customer ID',
    'nrm_customer_name': 'Vendor Name',
    'nrm_customer_number': 'Vendor ID',
    'customer_class': 'Vendor Class ID',
    'nrm_country_code': 'Country Code',
    'nrm_language_code': 'NULL',
    'nrm_currency_code': 'Currency ID',
    'nrm_phone_code': 'NULL',
    'nrm_tax_id_type': 'NULL',
    'nrm_country_name': 'Country',
    'country': 'Country',
    'country_code': 'Country Code',
    'county': 'County',
    'city': 'City',
    'post_code': 'Post Code',
    'address_1': 'Address 1',
    'address_2': 'Address 2',
    'address_3': 'Address 3',
    'tax_schedule_id': 'Tax Schedule ID',
    'tax_registration_number': 'Tax Registration Number',
    'payment_terms_id': 'Payment Terms ID',
    'credit_limit_amount': 'Credit Limit',
    'created_date': 'Created Date',
    'last_payment_date': 'Last Payment Date',
    'checkbook_id': 'Checkbook ID',
    'statement_name': 'NULL',
    'short_name': 'Vendor Short Name',
    'inactive': 'Inactive',
    'key_customer_name': 'NULL',
    'pipe_target_business_unit': 'Company',
    'business_unit': 'Company',
    'customer_number': 'Vendor ID',
    'customer_name': 'Vendor Name',
    'address_code': 'Vendor Address Code - Primary',
}

# Email/Phone specific mappings
email_phone_mapping = {
    'email_to_address': 'Email To Address',
    'email_cc_address': 'Email Cc Address',
    'email_bcc_address': 'Email Bcc Address',
    'phone_1': 'Phone Number 1',
    'phone_2': 'Phone Number 2',
    'phone_3': 'Phone 3',
    'fax': 'Fax Number',
}

output_dir = '/Users/rpatel/Documents/__code/git/emailrak/elt_lake/elt_ingest_excel/config/data'

for sheet_name, columns in mappings.items():
    output_path = os.path.join(output_dir, f'{sheet_name}_mapping.csv')
    
    with open(output_path, 'w', newline='') as csvfile:
        writer = csv.writer(csvfile)
        
        # Write header
        writer.writerow(['Output Column', 'Source Column (src_fin_customer)', 'Source Column (Input Excel)', 'Notes'])
        
        # Write mappings
        for output_col, source_col in columns:
            if source_col is None:
                writer.writerow([output_col, 'NULL', 'NULL', 'No mapping found'])
            elif '(constant)' in source_col or '(derived)' in source_col or '(transformed)' in source_col:
                writer.writerow([output_col, source_col, 'NULL', 'Calculated/derived value'])
            elif 'via' in source_col or 'or' in source_col.lower():
                writer.writerow([output_col, source_col, 'NULL', 'Complex mapping'])
            elif '+' in source_col:
                writer.writerow([output_col, source_col, 'NULL', 'Concatenated value'])
            elif source_col.startswith('email_') or source_col.startswith('phone_'):
                # Map to Excel columns
                excel_col = email_phone_mapping.get(source_col.split(' ')[0].split('/')[0], 'NULL')
                writer.writerow([output_col, source_col, excel_col, ''])
            else:
                # Try to find matching Excel column
                source_base = source_col.split(' ')[0]  # Get base column name
                excel_col = excel_equivalents.get(source_base, 'NULL')
                writer.writerow([output_col, source_col, excel_col, ''])
    
    print(f'Created: {output_path}')

print('\nAll mapping files created successfully!')
